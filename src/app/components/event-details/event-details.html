<div class="details-container">

  <!-- Loading -->
  @if (isLoading) {
    <div class="loading">Loading event...</div>
  } @else if (event) {
    <!-- Back Button -->
    <button class="back-link" (click)="goBack()">â† Back to Events</button>

    <!-- Event Card -->
    <div class="event-card">
      <div class="event-title-section">
        <div class="title-and-actions">
            <h1>{{ event.title }}</h1>
            @if (isOrganizer) {
                <div class="organizer-actions">
                    <button class="btn btn-danger" (click)="deleteEvent()">Delete</button>
                    <button class="btn btn-primary" (click)="editEvent()">Edit</button>
                </div>
            }
        </div>
        <div class="organizer-info">
          <span class="info-label">Organized by:</span>
          <span class="info-value">{{ event.organizer.name }}</span>
        </div>
      </div>
      <br/>

      <div class="info-row">
        <div class="info-item">
          <span class="info-label row-info-label">ğŸ“… Date & Time</span>
          <br/>
          <span class="info-value">{{ formatDate(event.date) }} at {{ event.time }}</span>
        </div>
        <div class="info-item">
          <span class="info-label row-info-label">ğŸ“ Location</span>
          <br/>
          <span class="info-value">{{ event.location }}</span>
        </div>
      </div>

      <div class="description-section">
        <h3 class="info-label">Description</h3>
        <p>{{ event.description }}</p>
      </div>
    </div>

    <!-- Organizer View -->
    @if (isOrganizer) {
      <div class="attendees-card">
        <div class="card-header">
          <h3>Attendees ({{ event.attendees.length }})</h3>
          <button class="btn btn-primary" (click)="openInviteModal()">Invite</button>
        </div>

        <div class="attendees-list">
          @if (event.attendees.length === 0) {
            <p class="no-attendees">No attendees yet. Invite people to your event!</p>
          } @else {
            @for (let attendee of event.attendees; track attendee.user._id) {
              <div class="attendee-item">
                <div class="attendee-info">
                  <div class="attendee-name">{{ attendee.user.name }}</div>
                  <div class="attendee-email">{{ attendee.user.email }}</div>
                </div>
                <div class="attendee-actions">
                  <span class="badge" [ngClass]="getStatusBadgeClass(attendee.status)">
                    {{ attendee.status }}
                  </span>
                </div>
              </div>
            }
          }
        </div>
      </div>

      <!-- Invite Modal -->
      @if (showInviteModal) {
        <div class="modal-overlay" (click)="closeInviteModal()">
          <div class="invite-modal" (click)="$event.stopPropagation()">
            <div class="modal-header">
              <h2>Invite Attendee</h2>
              <button class="modal-close" (click)="closeInviteModal()">âœ•</button>
            </div>

            <div class="modal-body">
              @if (inviteError) {
                <div class="error-alert">{{ inviteError }}</div>
              </div>
              <div class="form-group">
                <label class="form-label">Email Addresses <span class="required">*</span></label>
                <textarea
                  class="form-input"
                  [(ngModel)]="inviteEmails"
                  placeholder="Enter email addresses separated by comma, semicolon, or newline"
                ></textarea>
              </div>
            </div>

            <div class="modal-footer">
              <button class="btn btn-secondary" (click)="closeInviteModal()">Cancel</button>
              <button class="btn btn-primary" (click)="inviteUsers()">Send Invite</button>
            </div>
          </div>
        </div>
      }
    }

    <!-- Attendee View -->
    @if (!isOrganizer) {
      <div class="rsvp-card">
        <h3>Your Response</h3>
        <div class="rsvp-buttons">
          <button
            class="rsvp-btn"
            [class.active]="currentUserStatus === 'Going'"
            (click)="updateRSVP('Going')"
          >
            âœ“ Going
          </button>
          <button
            class="rsvp-btn"
            [class.active]="currentUserStatus === 'Not Going'"
            (click)="updateRSVP('Not Going')"
          >
            âœ• Not Going
          </button>
        </div>
        @if (!currentUserStatus || currentUserStatus === 'Pending') {
          <p class="no-response">You haven't responded yet</p>
        } @else {
          <p class="response-status">You responded: <strong>{{ currentUserStatus }}</strong></p>
        }
      </div>
    }
  }
</div>
<!-- Attendees Summary (Organizer View) -->
@if (isOrganizer) {
  <div class="attendees-summary">
    <div class="summary-item">
      <span class="summary-label">âœ… Going</span>
      <span class="summary-value">{{ event.attendees.filter(a => a.status === 'Going').length }}</span>
    </div>
    <div class="summary-item">
      <span class="summary-label">â“ Maybe</span>
      <span class="summary-value">{{ event.attendees.filter(a => a.status === 'Maybe').length }}</span>
    </div>
    <div class="summary-item">
      <span class="summary-label">âŒ Not Going</span>
      <span class="summary-value">{{ event.attendees.filter(a => a.status === 'Not Going').length }}</span>
    </div>
    <div class="summary-item">
      <span class="summary-label">â³ Pending</span>
      <span class="summary-value">{{ event.attendees.filter(a => a.status === 'Pending').length }}</span>
    </div>
  </div>
}
