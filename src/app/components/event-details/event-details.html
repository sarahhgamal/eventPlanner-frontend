<div class="details-container">

  <!-- Loading -->
  @if (isLoading) {
    <div class="loading">Loading event...</div>
  } @else if (event) {
    <!-- Back Button -->
    <button class="back-link" (click)="goBack()">‚Üê Back to Events</button>

    <!-- Success Message -->
    @if (successMessage) {
      <div class="success-alert">{{ successMessage }}</div>
    }

    <!-- Event Card -->
    <div class="event-card">
      <div class="event-title-section">
        <div class="title-and-actions">
            <h1>{{ event.title }}</h1>
            @if (event.userRole === 'organizer') {
                <div class="organizer-actions">
                    <button class="btn btn-danger" (click)="deleteEvent()">Delete</button>
                    <button class="btn btn-primary" (click)="editEvent()">Edit</button>
                </div>
            }
        </div>
        <div class="organizer-info">
          <span class="info-label">Organized by:</span>
          <span class="info-value">{{ event.organizer.name }}</span>
        </div>
      </div>
      <br/>

      <div class="info-row">
        <div class="info-item">
          <span class="info-label row-info-label">üìÖ Date & Time</span>
          <br/>
          <span class="info-value">{{ event.date }} at {{ event.time }}</span>
        </div>
        <div class="info-item">
          <span class="info-label row-info-label">üìç Location</span>
          <br/>
          <span class="info-value">{{ event.location }}</span>
        </div>
      </div>

      <div class="description-section">
        <h3 class="info-label">Description</h3>
        <p>{{ event.description }}</p>
      </div>
    </div>

    @if (event.userRole === 'organizer') {
      <!-- Attendees List -->
      <div class="attendees-card">
        <div class="card-header">
          <h3>Attendees ({{ event.attendees.length }})</h3>
          <button class="btn btn-primary" (click)="openInviteModal()">Invite</button>
        </div>

        <div class="attendees-list">
          @if (event.attendees.length === 0) {
            <p class="no-attendees">No attendees yet. Invite people to your event!</p>
          } @else {
            @for (attendee of event.attendees; track attendee.id) {
              <div class="attendee-item">
                <div class="attendee-info">
                  <div class="attendee-name">{{ attendee.name }}</div>
                  <div class="attendee-email">{{ attendee.email }}</div>
                </div>

                <div class="attendee-actions">
                  <span class="badge" [ngClass]="getStatusBadgeClass(attendee.status)">
                    {{ getStatusLabel(attendee.status) }}
                  </span>
                  <button class="btn-remove" (click)="removeAttendee(attendee.id)" title="Remove attendee">
                    ‚úï
                  </button>
                </div>
              </div>
            }
          }
        </div>
      </div>

      <!-- Delete Confirmation Modal -->
      @if (showDeleteConfirm) {
        <div class="modal-overlay" (click)="cancelDelete()">
          <div class="confirm-modal" (click)="$event.stopPropagation()">
            <h2>Delete Event?</h2>
            <p>Are you sure you want to delete <strong>{{ event.title }}</strong>? This action cannot be undone.</p>
            <div class="modal-actions">
              <button class="btn btn-secondary" (click)="cancelDelete()">Cancel</button>
              <button class="btn btn-danger" (click)="confirmDelete()">Delete</button>
            </div>
          </div>
        </div>
      }

      <!-- Invite Modal -->
      @if (showInviteModal) {
        <div class="modal-overlay" (click)="closeInviteModal()">
          <div class="invite-modal" (click)="$event.stopPropagation()">
            <div class="modal-header">
              <h2>Invite Attendee</h2>
              <button class="modal-close" (click)="closeInviteModal()">‚úï</button>
            </div>

            <div class="modal-body">
              @if (inviteError) {
                <div class="error-alert">{{ inviteError }}</div>
              }

              <div class="form-group">
                <label class="form-label">Email Address <span class="required">*</span></label>
                <input
                  type="email"
                  class="form-input"
                  [(ngModel)]="inviteEmail"
                  placeholder="Enter email address" 
                >
              </div>
            </div>

            <div class="modal-footer">
              <button class="btn btn-secondary" (click)="closeInviteModal()">Cancel</button>
              <button class="btn btn-primary" (click)="sendInvite()">Send Invite</button>
            </div>
          </div>
        </div>
      }
    }

    <!-- Attendee View -->
    @if (event.userRole === 'attendee') {
      <!-- RSVP Section -->
      <div class="rsvp-card">
        <h3>Your Response</h3>
        <div class="rsvp-buttons">
          <button
            class="rsvp-btn"
            [class.active]="event.userRSVP === 'going'"
            (click)="updateRSVP('going')"
          >
            ‚úì Going
          </button>
          <button
            class="rsvp-btn"
            [class.active]="event.userRSVP === 'notgoing'"
            (click)="updateRSVP('notgoing')"
          >
            ‚úï Not Going
          </button>
        </div>
        @if (!event.userRSVP) {
          <p class="no-response">You haven't responded yet</p>
        } @else {
          <p class="response-status">You responded: <strong>{{ getStatusLabel(event.userRSVP) }}</strong></p>
        }
      </div>

      <!-- Attendees Summary -->
      <div class="attendees-summary">
        <h3>Attendees ({{ event.attendees.length }})</h3>
        <div class="summary-stats">
            <div class="stat">
                <span class="stat-value">{{ goingCount }}</span>
                <span class="stat-label">Going</span>
            </div>

            <div class="stat">
                <span class="stat-value">{{ pendingCount }}</span>
                <span class="stat-label">Pending</span>
            </div>

            <div class="stat">
                <span class="stat-value">{{ notGoingCount }}</span>
                <span class="stat-label">Not Going</span>
            </div>
            </div>
      </div>
    }
  }
</div>