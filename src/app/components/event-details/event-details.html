<div class="details-container">

  <!-- Loading -->
  @if (isLoading()) {
    <div class="loading">Loading event...</div>
  } @else if (event) {
    <!-- Back Button -->
    <button class="back-link" (click)="goBack()">‚Üê Back to Events</button>

    <!-- Event Card -->
    <div class="event-card">
      <div class="event-title-section">
        <div class="title-and-actions">
            <h1>{{ event.title }}</h1>
            @if (isOrganizer) {
                <div class="organizer-actions">
                    <button class="btn btn-danger" (click)="openDeleteConfirm()">Delete</button>
                    <button class="btn btn-primary" (click)="openEditModal()">Edit</button>
                </div>
            }
        </div>
        <div class="organizer-info">
          <span class="info-label">Organized by:</span>
          <span class="info-value">{{ event.organizer.name }}</span>
        </div>
      </div>
      <br/>

      <div class="info-row">
        <div class="info-item">
          <span class="info-label row-info-label">üìÖ Date & Time</span>
          <br/>
          <span class="info-value">{{ formatDate(event.date) }} at {{ event.time }}</span>
        </div>
        <div class="info-item">
          <span class="info-label row-info-label">üìç Location</span>
          <br/>
          <span class="info-value">{{ event.location }}</span>
        </div>
      </div>

      <div class="description-section">
        <h3 class="info-label">Description</h3>
        <p>{{ event.description }}</p>
      </div>
    </div>

    @if (isOrganizer) {
      <!-- Attendees List -->
      <div class="attendees-card">
        <div class="card-header">
          <h3>Attendees ({{ event.attendees.length }})</h3>
          <button class="btn btn-primary" (click)="openInviteModal()">Invite</button>
        </div>

        <div class="attendees-list">
          @if (event.attendees.length === 0) {
            <p class="no-attendees">No attendees yet. Invite people to your event!</p>
          } @else {
            @for (attendee of event.attendees; track attendee._id) {
              <div class="attendee-item">
                <div class="attendee-info">
                  <div class="attendee-name">{{ attendee.user.name }}</div>
                  <div class="attendee-email">{{ attendee.user.email }}</div>
                </div>

                <div class="attendee-actions">
                  <span class="badge" [ngClass]="getStatusBadgeClass(attendee.status)">
                    {{ attendee.status }}
                  </span>
                </div>
              </div>
            }
          }
        </div>
      </div>

      <!-- Invite Modal -->
      @if (showInviteModal) {
        <div class="modal-overlay" (click)="closeInviteModal()">
          <div class="invite-modal" (click)="$event.stopPropagation()">
            <div class="modal-header">
              <h2>Invite Attendees</h2>
              <button class="modal-close" (click)="closeInviteModal()">‚úï</button>
            </div>

            <div class="modal-body">
              @if (inviteError) {
                <div class="error-alert">{{ inviteError }}</div>
              }

              <div class="form-group">
                <label class="form-label">Email Addresses <span class="required">*</span></label>
                <textarea
                  class="form-input"
                  [(ngModel)]="inviteEmails"
                  placeholder="Enter email addresses (separate with commas, semicolons, or new lines)"
                  rows="4"
                ></textarea>
                <small class="form-hint">You can enter multiple emails separated by commas, semicolons, or new lines</small>
              </div>
            </div>

            <div class="modal-footer">
              <button class="btn btn-secondary" (click)="closeInviteModal()">Cancel</button>
              <button class="btn btn-primary" (click)="inviteUsers()">Send Invites</button>
            </div>
          </div>
        </div>
      }

      <!-- Edit Event Modal -->
      @if(showEditModal && event) {
        <app-event-edit 
          [eventId]="event._id"
          [eventData]="event"
          (close)="closeEditModal()"
          (save)="saveEditedEvent($event)">
        </app-event-edit>
      }

      <!-- Delete Event Modal -->
      @if(showDeleteConfirm && event) {
        <div class="modal-overlay" (click)="closeDeleteConfirm()">
          <div class="modal-content sm-modal" (click)="$event.stopPropagation()">
            <div class="modal-header">
              <h2>Confirm Delete</h2>
              <button class="modal-close" (click)="closeDeleteConfirm()">‚úï</button>
            </div>
            
            <div class="modal-body">
              <p class=form-label>Are you sure you want to delete the event <strong>"{{ event.title }}"</strong>?</p>
              <p class="warning-text">This action cannot be undone.</p>
            </div>
            
            <div class="modal-footer">
              <button type="button" class="btn-cancel" (click)="closeDeleteConfirm()">Cancel</button>
              <button type="button" class="btn-delete-confirm" (click)="confirmDelete()">Delete Event</button>
            </div>
          </div>
        </div>
      }
    }

    <!-- Attendee View -->
    @if (!isOrganizer) {
      <!-- RSVP Section -->
      <div class="rsvp-card">
        <h3>Your Response</h3>
        <div class="rsvp-buttons">
          <button
            class="rsvp-btn"
            [class.active]="currentUserStatus === 'Going'"
            (click)="updateRSVP('Going')"
          >
            ‚úì Going
          </button>
          <button
            class="rsvp-btn"
            [class.active]="currentUserStatus === 'Maybe'"
            (click)="updateRSVP('Maybe')"
          >
            ? Maybe
          </button>
          <button
            class="rsvp-btn"
            [class.active]="currentUserStatus === 'Not Going'"
            (click)="updateRSVP('Not Going')"
          >
            ‚úï Not Going
          </button>
        </div>
        @if (currentUserStatus === 'Pending') {
          <p class="no-response">You haven't responded yet</p>
        } @else {
          <p class="response-status">You responded: <strong>{{ currentUserStatus }}</strong></p>
        }
      </div>

      <!-- Attendees Summary -->
      <div class="attendees-summary">
        <h3>Attendees ({{ event.attendees.length }})</h3>
        <div class="summary-stats">
            <div class="stat">
                <span class="stat-value">{{ goingCount }}</span>
                <span class="stat-label">Going</span>
            </div>

            <div class="stat">
                <span class="stat-value">{{ maybeCount }}</span>
                <span class="stat-label">Maybe</span>
            </div>

            <div class="stat">
                <span class="stat-value">{{ pendingCount }}</span>
                <span class="stat-label">Pending</span>
            </div>

            <div class="stat">
                <span class="stat-value">{{ notGoingCount }}</span>
                <span class="stat-label">Not Going</span>
            </div>
        </div>
      </div>
    }
  }
</div>