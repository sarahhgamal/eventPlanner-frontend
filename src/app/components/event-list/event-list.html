<div class="event-list-container">
  <!-- Sidebar -->
  <div class="sidebar" [class.expanded]="sidebarExpanded">
    <div class="sidebar-header">
      <button class="toggle-btn" (click)="toggleSidebar()">
        <span class="hamburger-icon">â˜°</span>
      </button>
      @if(sidebarExpanded) {
        <h3>Menu</h3>
      }
    </div>
    
    <nav class="sidebar-nav">
      <a class="nav-item active" (click)="toggleSidebar()">
        <span class="icon">ðŸ“…</span>
        @if(sidebarExpanded) {
          <span class="label">Events</span>
        }
      </a>
      <a class="nav-item" (click)="toggleSidebar()">
        <span class="icon">ðŸ“Š</span>
        @if(sidebarExpanded) {
          <span class="label">Dashboard</span>
        }
      </a>
      <a class="nav-item logout" (click)="logout()">
        <span class="icon">ðŸšª</span>
        @if(sidebarExpanded) {
          <span class="label">Logout</span>
        }
      </a>
    </nav>
  </div>

  <!-- Main Content -->
  <div class="main-content" [class.sidebar-expanded]="sidebarExpanded">
    <div class="content-wrapper">
      <!-- Header -->
      <div class="page-header">
        <h1>Events</h1>
        <button class="btn-create" (click)="openCreateModal()">+ Create Event</button>
      </div>

      <!-- Search and Filter Bar -->
      <div class="search-filter-bar">
        <div class="search-box">
          <input 
            type="text" 
            placeholder="Search events by name, date, location, description, or role..." 
            [(ngModel)]="searchQuery"
            (ngModelChange)="onSearchChange()"
            class="search-input"
          />
        </div>
        
        <div class="filter-box">
          <select [(ngModel)]="filterRSVP" (ngModelChange)="onFilterChange()" class="filter-select">
            <option value="all">All Events</option>
            <option value="going">Going</option>
            <option value="maybe">Maybe</option>
            <option value="notgoing">Not Going</option>
          </select>
        </div>
      </div>

      <!-- Events Table -->
      <div class="events-table-container">
        @if(isLoading) {
          <div class="loading">Loading events...</div>
        } @else if(filteredEvents.length === 0) {
          <div class="no-events">
            <p>No events found</p>
            @if(searchQuery || filterRSVP !== 'all') {
              <button class="btn-reset" (click)="searchQuery = ''; filterRSVP = 'all'; applyFilters()">
                Clear Filters
              </button>
            }
          </div>
        } @else {
          <table class="events-table">
            <thead>
              <tr>
                <th>Event Name</th>
                <th>Date</th>
                <th>Time</th>
                <th>Location</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              @for(event of filteredEvents; track event.id) {
                <tr class="event-row" (click)="navigateToDetails(event.id)">
                  <td class="event-title">{{ event.title }}</td>
                  <td>{{ event.date }}</td>
                  <td>{{ event.time }}</td>
                  <td>{{ event.location }}</td>
                  <td>
                    <span class="badge" [ngClass]="getRSVPBadgeClass(event.userRSVP)">
                      {{ getRSVPLabel(event) }}
                    </span>
                  </td>
                  <td class="actions-cell" (click)="$event.stopPropagation()">
                    @if(event.userRole === 'organizer') {
                      <button class="btn-action btn-edit" (click)="openEditModal(event)">Edit</button>
                      <button class="btn-action btn-delete" (click)="openDeleteConfirm(event)">Delete</button>
                    } @else {
                      <span class="no-actions">â€”</span>
                    }
                  </td>
                </tr>
              }
            </tbody>
          </table>
        }
      </div>
    </div>
  </div>

  <!-- Create Event Modal -->
  @if(showCreateModal) {
    <div class="modal-overlay" (click)="closeCreateModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>Create New Event</h2>
          <button class="close-btn" (click)="closeCreateModal()">&times;</button>
        </div>
        
        <form (ngSubmit)="createEvent()" class="modal-form">
          @if(createError) {
            <div class="error-message">{{ createError }}</div>
          }
          
          <div class="form-group">
            <label>Event Title *</label>
            <input type="text" [(ngModel)]="newEventTitle" name="title" required />
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label>Date *</label>
              <input type="date" [(ngModel)]="newEventDate" name="date" required />
              @if(dateError) {
                <span class="field-error">{{ dateError }}</span>
              }
            </div>
            
            <div class="form-group">
              <label>Time *</label>
              <input type="time" [(ngModel)]="newEventTime" name="time" required />
            </div>
          </div>
          
          <div class="form-group">
            <label>Location *</label>
            <input type="text" [(ngModel)]="newEventLocation" name="location" required />
          </div>
          
          <div class="form-group">
            <label>Description *</label>
            <textarea [(ngModel)]="newEventDescription" name="description" rows="4" required></textarea>
          </div>
          
          <div class="modal-actions">
            <button type="button" class="btn-cancel" (click)="closeCreateModal()">Cancel</button>
            <button type="submit" class="btn-submit">Create Event</button>
          </div>
        </form>
      </div>
    </div>
  }

  <!-- Edit Event Modal -->
  @if(showEditModal && selectedEvent) {
    <app-event-edit 
      [eventId]="selectedEvent.id"
      [eventData]="selectedEvent"
      (close)="closeEditModal()"
      (save)="saveEditedEvent($event)">
    </app-event-edit>
  }

  <!-- Delete Confirmation Modal -->
  @if(showDeleteConfirm && selectedEvent) {
    <div class="modal-overlay" (click)="closeDeleteConfirm()">
      <div class="modal-content delete-modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>Confirm Delete</h2>
        </div>
        
        <div class="modal-body">
          <p>Are you sure you want to delete the event <strong>"{{ selectedEvent.title }}"</strong>?</p>
          <p class="warning-text">This action cannot be undone.</p>
        </div>
        
        <div class="modal-actions">
          <button type="button" class="btn-cancel" (click)="closeDeleteConfirm()">Cancel</button>
          <button type="button" class="btn-delete-confirm" (click)="confirmDelete()">Delete Event</button>
        </div>
      </div>
    </div>
  }
</div>