<div class="event-list-container">
  <!-- Sidebar -->
  <div class="sidebar" [class.expanded]="sidebarExpanded">
    <div class="sidebar-header">
      <button class="toggle-btn" (click)="toggleSidebar()">
        <span class="hamburger-icon">â˜°</span>
      </button>
      @if(sidebarExpanded) {
        <h3>Menu</h3>
      }
    </div>
    
    <nav class="sidebar-nav">
      <a class="nav-item active" (click)="toggleSidebar()">
        <span class="icon">ðŸ“…</span>
        @if(sidebarExpanded) {
          <span class="label">Events</span>
        }
      </a>
      <a class="nav-item logout" (click)="logout()">
        <span class="icon">ðŸšª</span>
        @if(sidebarExpanded) {
          <span class="label">Logout</span>
        }
      </a>
    </nav>
  </div>

  <!-- Main Content -->
  <div class="main-content" [class.sidebar-expanded]="sidebarExpanded">
    <div class="content-wrapper">
      <!-- Header -->
      <div class="page-header">
        <h1>Events</h1>
        <button class="btn-create" (click)="openCreateModal()">+ Create Event</button>
      </div>

      <!-- Tabs -->
      <div class="tabs-container">
        <button 
          class="tab-btn" 
          [class.active]="activeTab === 'all'"
          (click)="switchTab('all')">
          All Events
        </button>
        <button 
          class="tab-btn" 
          [class.active]="activeTab === 'organized'"
          (click)="switchTab('organized')">
          My Organized Events
        </button>
        <button 
          class="tab-btn" 
          [class.active]="activeTab === 'invited'"
          (click)="switchTab('invited')">
          My Invited Events
        </button>
      </div>

      <!-- Search and Filter Bar -->
      <div class="search-filter-bar">
        <div class="search-box">
          <input 
            type="text" 
            placeholder="Search events by name, location, or description..." 
            [(ngModel)]="searchQuery"
            (ngModelChange)="onSearchChange()"
            class="search-input"
          />
        </div>
        
        <!-- Status filter only shown for invited events tab -->
        @if(activeTab === 'invited') {
          <div class="filter-box">
            <select [(ngModel)]="filterRSVP" (ngModelChange)="onFilterChange()" class="filter-select">
              <option value="all">All Statuses</option>
              <option value="pending">Pending</option>
              <option value="going">Going</option>
              <option value="maybe">Maybe</option>
              <option value="notgoing">Not Going</option>
            </select>
          </div>
        }
      </div>

      <!-- Events Table -->
      <div class="events-table-container">
        @if(isLoading()) {
          <div class="loading">Loading events...</div>
        } @else if(filteredEvents.length === 0) {
          <div class="no-events">
            <p>No events found</p>
            @if(searchQuery || filterRSVP !== 'all') {
              <button class="btn-reset" (click)="searchQuery = ''; filterRSVP = 'all'; applyFilters()">
                Clear Filters
              </button>
            }
          </div>
        } @else {
          <table class="events-table">
            <thead>
              <tr>
                <th>Event Name</th>
                <th>Date</th>
                <th>Time</th>
                <th>Location</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              @for(event of filteredEvents; track event.id) {
                <tr class="event-row" (click)="navigateToDetails(event.id)">
                  <td class="event-title">{{ event.title }}</td>
                  <td>{{ event.date }}</td>
                  <td>{{ event.time }}</td>
                  <td>{{ event.location }}</td>
                  <td>
                    <span class="badge" [ngClass]="getRSVPBadgeClass(event.userRSVP)">
                      {{ getRSVPLabel(event) }}
                    </span>
                  </td>
                  <td class="actions-cell" (click)="$event.stopPropagation()">
                    @if(event.userRole === 'organizer') {
                      <button class="btn-action btn-edit" (click)="openEditModal(event)">Edit</button>
                      <button class="btn-action btn-delete" (click)="openDeleteConfirm(event)">Delete</button>
                    } @else {
                      <button class="btn-action btn-status" (click)="openChangeStatusModal(event)">Change Status</button>
                    }
                  </td>
                </tr>
              }
            </tbody>
          </table>
        }
      </div>
    </div>
  </div>

  <!-- Create Event Modal -->
  @if(showCreateModal) {
    <app-event-create
      (close)="closeCreateModal()"
      (submitCreate)="handleChildCreate($event)">
  </app-event-create>
  }

  <!-- Edit Event Modal -->
  @if(showEditModal && selectedEvent) {
    <app-event-edit 
      [eventId]="selectedEvent.id"
      [eventData]="selectedEvent"
      (close)="closeEditModal()"
      (save)="saveEditedEvent($event)">
    </app-event-edit>
  }

  <!-- Delete Confirmation Modal -->
  @if(showDeleteConfirm && selectedEvent) {
    <div class="modal-overlay" (click)="closeDeleteConfirm()">
      <div class="modal-content sm-modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>Confirm Delete</h2>
          <button class="close-btn" (click)="closeDeleteConfirm()">âœ•</button>
        </div>
        
        <div class="modal-body">
          <p>Are you sure you want to delete the event <strong>"{{ selectedEvent.title }}"</strong>?</p>
          <p class="warning-text">This action cannot be undone.</p>
        </div>
        
        <div class="modal-footer">
          <button type="button" class="btn-cancel" (click)="closeDeleteConfirm()">Cancel</button>
          <button type="button" class="btn-delete-confirm" (click)="confirmDelete()">Delete Event</button>
        </div>
      </div>
    </div>
  }

  <!-- Change Status Modal -->
  @if(showChangeStatusModal && selectedEvent) {
    <div class="modal-overlay" (click)="closeChangeStatusModal()">
      <div class="modal-content sm-modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>Update RSVP Status</h2>
          <button class="close-btn" (click)="closeChangeStatusModal()">âœ•</button>
        </div>

        <div class="modal-body">
          <p>Change your RSVP status for <strong>{{ selectedEvent.title }}</strong>:</p>
          <div class="status-options">
            <label>
              <input type="radio" name="rsvp" value="going" [(ngModel)]="pendingStatus" />Going
            </label>
            <label>
              <input type="radio" name="rsvp" value="maybe" [(ngModel)]="pendingStatus" />Maybe
            </label>
            <label>
              <input type="radio" name="rsvp" value="notgoing" [(ngModel)]="pendingStatus" />Not Going
            </label>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn-cancel" (click)="closeChangeStatusModal()">Cancel</button>
          <button type="button" class="btn-submit" (click)="changeRSVPStatus()">Update</button>
        </div>
      </div>
    </div>
  }
</div>